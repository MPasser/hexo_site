---
title: 存储技术基础-学习笔记
date: 2019/08/02
categories: 存储
tags: 存储
---
#### 部分基础概念
##### 存储的三种主要架构方式：DAS、NAS、SAN
- DAS：存储通过SAS、iSCSI或FC等接口与服务器直接连接，中间没有任何转换交换设备，作为服务器内置硬盘容量的扩充。
- NAS：通过IP网络访问的文件系统，可以理解为服务器+硬盘+文件系统软件的组合。
    - 主要指标：
        - OPS：每秒操作数，体现并发处理能力。
        - ORT（Overall Response Time）：客户得到服务器响应的快慢，以ms为单位。
- SAN：SAN是一种专门用于存储的专业网络，RAID在存储器端进行设置。SAN的结构允许任何服务器连接到任何存储阵列，这样不管数据置放在那里，服务器都可直接存取所需的数据。
    - 主要指标：
        - IOPS：单位时间内能够处理的最大I/O数量。
        - Throughput：单位时间内最大的I/O流量。

##### 外置磁盘存储系统硬件构成：
硬盘、控制器、Cache、BBU（断电保护）、电源、风扇

##### RAID
（Redundant Arrays of Independent Drives ，磁盘阵列）
- RAID0：简单、无数据校验的数据条带化技术。一般用于视频、图像编辑。
- RAID1：简单地镜像数据。用于财务、金融系统。
- RAID3：使用专用校验盘的数据条带化技术。用于视频监控等高吞吐量的场景。
- RAID5：使用不固定校验盘的数据条带化技术。用于OLTP、数据库系统。
- RAID6：使用双重校验。用于需求高安全性的场景。
- RAID10：RAID0+RAID1 ，将数据条带化后进行镜像备份。
分布式RAID：将磁盘分区，热备区分布在不同磁盘区域。数据重构快，且无闲置的热备盘。

软硬RAID的各自的应用场景如下：
- 软RAID 适合不需要写Cache和掉电保护， CPU有剩余且OS较为通用的场景；
- 硬RAID与主机系统松耦合，并可以提供完整的数据保护功能，适合需要写CACHE，并且对写性能有较高要求的场景。
- 软硬RAID各有各自的好处，大多数存储厂商用软RAID。RAID卡一般是放在服务器上的.

##### 热备（HotSpare） 热插拔（HotSpot）
##### 存储协议SCSI
（Small Computer System Interface ，小型电脑系统接口），用于主机与外部设备之间的连接。
层级：  
↑特定设备指令集  
↑基础指令集  
↑SCSI传输协议  
↑物理连接

##### 存储协议FC
（Fiber Channel ，光纤通道）
层级：
- FC-4：协议映射层，定义了光纤通道和上层应用之间的接口，上层应用比如：串行SCSI协议，HBA卡的驱动提供了FC-4 的接口函数。FC-4 支持多协议，如：FCP-SCSI，FC-IP，FC-VI。
- FC-3：定义了常用服务，如数据加密和压缩。
- FC-2：网络层，光纤通道的核心, 定义了帧、流控制、和服务质量等。
- FC-1：传输协议层或数据链接层，编码或解码信号。
- FC-0：连接物理介质的界面、电缆等；定义编码和解码的标准。

三种结构：点对点、仲裁环（Arbitrated Loop）、交换式（Fabric）。

FC端口类型
- 服务器或存储设备：N端口、NL端口。
- FC交换机：F、FL、E、G端口。

##### 存储协议ISCSI
##### 存储协议CIFS和NFS
连接建立专用会话通道。
##### 存储协议FCIP
通过IP连接成一个大的FC-SAN
##### 存储协议NVMe
（Non-Volatile Memory express ，非易失性存储标准），与AHCI一样都是逻辑设备接口标准。是使用PCI-E通道SSD的一种规范。
有更短的I/O路径、多队列、无固有延时。

##### 存储映射（分区）
- 一个或多个卷的逻辑分组。
- 限制对一个主机或主机组的存取访问。
- 一组volume-to-LUN 的映射。

##### LUN
（Logical Unit Number ，逻辑单元编号）
- 主机用于访问一个卷的编号。
- 每个主机都有自己的LUN地址空间。
- 相同的LUN可能被不同的主机用来访问不同卷。
- 一个卷只能被用于映射给一个LUN和一个主机（或主机组）。

##### 映射方式
1. LUN mapping ：在存储上主机通道指派一个数字给逻辑卷，这个通道上可能有多个LUN 。
2. LUN masking ：指派一个主机的wwn与一个LUN对应。过滤掉了其他的LUN。（一般使用这个）

##### 多数据切换软件的必要性
MPIO仅仅识别一个主空间

##### 多路径切换软件类型
- 底层驱动：RDAC（隐藏多余路径）。
- 底层驱动：device-mapper 、powerpath 、HDLM （生成第三方磁盘设备）。
- 可配置的卷管理软件

#### 存储常用术语
##### 双控制器配置
为提高冗余性有两个控制器控制。
MAID
以节能为目的，在无读写访问时下电。
路径冗余
扩展柜
≈ 阵列 - 控制器
主机、磁盘扩展接口
备份策略
全备、增量备份、差异备份
Lan备份、Lan-Free备份

##### 快照
（Snapshot）基于时间点的卷的映像，逻辑上等同于一个物理copy 。

##### 卷复制
（Volume Copy）完全复制。完全的时间点的备份数据集合用于分析、数据挖掘或测试，同时提高Backup/Restore 能力。

##### 卷镜像
实时同步，主机通过复制引擎（硬/软件）对两个不同的存储（LUN）进行相同的I/O操作。
50km同步镜像：服务器→ primary site → remote site → primary site → 服务器  
5000km异步镜像：服务器→ primary site → 服务器	primary site → remote site → primary site

##### 特点：
- 镜像关系建立在卷上。
- 不允许对次要卷作主机写I/O 。
- 一个卷只能建立一个远程镜像。
- 所有卷必须为标卷。
- 两卷必须同属于相同的控制器。

##### 基于主机、存储设备或网络设备。
↑存储虚拟化  
↑客户端  
↑统一数据管理  
↑存储资源整合

##### 存储自动分层
（Easy Tiering）
由于20%的数据占资料活动量的80% 。随意需要使用不断变化的数据放置方式。→按数据使用频次进行数据迁移→高使用频次数据放入性能最高的第一层

##### 自动精简配置
“欺骗手段” 容量使用量接近真实分配的容量后增加分配容量。（例如百度网盘）

##### 重复数据删除
重复数据块用指针代替。（数据库由于特殊的文件格式不推荐使用）

##### 压缩卷
- 适用：数据库、服务器虚拟化、邮件系统。
- 不适用：视频、图片、加密数据。

##### 硬盘的接口种类：
SATA 、SCSI 、SAS 、FC
主要指标：容量、单碟容量、转速、缓存。

##### SAS
（Serial Attached SCSI ，串行连接SCSI）解决了诸多SCSI困境。
点对点、全双工、双端口、高性能、兼容SATA 。

##### SATA
（Serial ATA ，串行ATA）
接口速率比IDE高，最低150MB/s 、点对点、热插拔。

##### FC
采用FC-AL（Fiber Channel Arbitrated Loop ，光纤通道仲裁环）
双端口、全双工、串行存储接口。

##### SSD
固态硬盘，分为SLC和MLC

##### 磁带设备
组成：
- 磁带机：具有特殊数据格式，用于数据校验。
- 自动加载机
- 磁带库：由库体和磁带驱动器组成。

##### 磁带设备主要指标
- 备份容量、备份速率、接口类型
- 其他：级联扩展、分区等等。

##### 存储交换机
组成：CPU 、串口（RS232）、SPF端口、以太网口（RJ45）、Bloom ASIC 、风扇、电源。

##### FC HBA卡：光纤主机适配卡。

##### 文件分类：
控制文件、数据文件、索引文件、日志文件

##### 服务分类：
文件服务、打印服务、WEB服务、BBS服务、数据库服务、邮件服务、视频服务、非线编

##### 可靠性方案
- 集中存储：冗余
- 双机高可用、双机双存储、备份方案
- 高可用：主机、交换机